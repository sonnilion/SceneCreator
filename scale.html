<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>
      Scale
    </title>
    <script type="text/javascript" language="javascript">
    function ok() {
    if (!window.opener.closed){
      opener.setSize(document.getElementById("length").value, document.getElementById("width").value, document.getElementById("height").value);
      opener.unpause3d();
      window.close();
      }
    }
    function cancel() {
      opener.unpause3d();
      window.close(); 
    } 
    </script>
  </head>
  <body>
        
        <form>
        <img src="" id="item" onclick="crazy()" />
        <table>
        <tr>  
          <td>Length:</td>
          <td><input type="text" id="length" onfocus="setCurLength()" onchange="maintainAspectRatioLength()"/></td> 
        </tr>
        <tr>
      
          <td>Width:</td>
          <td><input type="text" id="width" onfocus="setCurWidth()" onchange="maintainAspectRatioWidth()"/></td>      
        </tr>
        <tr>
         
          <td>Hieght:</td>
          <td><input type="text" id="height" onfocus="setCurHeigth()" onchange="maintainAspectRatioHeight()" /> </td>
        </tr>
        </table>
        <input type="checkbox" checked=checked id="mar" /> Maintain Aspect Ratio<br />
        <input type="button" value="Back" onclick="cancel()"/>
        <input type="button" value="OK" onclick="ok()"/>
        </form>
        <script type="text/javascript" language="javascript">
            document.getElementById("item").src = opener.getPic();
            document.getElementById("length").value=opener.getSize()[0].toFixed(2);
            document.getElementById("width").value=opener.getSize()[2].toFixed(2);
            document.getElementById("height").value=opener.getSize()[1].toFixed(2);
            
          function maintainAspectRatioLength(){
            document.getElementById("length").value = parseFloat(document.getElementById("length").value).toFixed(2);
            if (document.getElementById("mar").checked) { 
              newLength = document.getElementById("length").value;
              if (newLength > oldLength) {
                document.getElementById("width").value= (document.getElementById("width").value * (newLength / oldLength)).toFixed(2);
                document.getElementById("height").value= (document.getElementById("height").value* (newLength / oldLength)).toFixed(2);
              }
              else if (newLength < oldLength) {
              document.getElementById("width").value= document.getElementById("width").value * 1/(oldLength / newLength).toFixed(2);
              document.getElementById("height").value= document.getElementById("height").value * 1/(oldLength / newLength).toFixed(2);
              }
            }
          }
          function maintainAspectRatioWidth(){
            document.getElementById("width").value = parseFloat(document.getElementById("width").value).toFixed(2);
            if (document.getElementById("mar").checked) {
              newWidth = document.getElementById("width").value;
              if (newWidth > oldWidth) {
                document.getElementById("length").value= (document.getElementById("length").value * (newWidth / oldWidth)).toFixed(2);
                document.getElementById("height").value= (document.getElementById("height").value* (newWidth / oldWidth)).toFixed(2);
              }
              else if (newWidth < oldWidth) {
              document.getElementById("length").value= (document.getElementById("length").value * 1/(oldWidth / newWidth)).toFixed(2);
              document.getElementById("height").value= (document.getElementById("height").value * 1/(oldWidth / newWidth)).toFixed(2);
              }
            }
          }
          function maintainAspectRatioHeight(){
            document.getElementById("height").value = parseFloat(document.getElementById("height").value).toFixed(2);  
            if (document.getElementById("mar").checked) {
              newHeight = document.getElementById("height").value;
              if (newHeight > oldHeight) {
                document.getElementById("width").value= (document.getElementById("width").value * (newHeight / oldHeight)).toFixed(2);
                document.getElementById("length").value= (document.getElementById("length").value* (newHeight / oldHeight)).toFixed(2);
              }
              else if (newHeight < oldHeight) {
              document.getElementById("width").value= (document.getElementById("width").value * 1/(oldHeight / newHeight)).toFixed(2);
              document.getElementById("length").value= (document.getElementById("length").value * 1/(oldHeight / newHeight)).toFixed(2);
              }
            }
          }
          function setCurHeigth() {
          oldHeight= document.getElementById("height").value;
          }
          function setCurLength() {
          oldLength= document.getElementById("length").value;
          }
          function setCurWidth() {
          oldWidth= document.getElementById("width").value;
          }

        </script>
  </body>
</html>