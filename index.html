<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>
      SceneCreator
    </title>
    <script>var pro= [];</script>
    <link type="text/css" href="css/style.css" rel="stylesheet" />
    <script type="text/javascript" src="js/jquery/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="js/jquery/jquery-ui-1.8.1.custom.min.js"></script>
    <script language="javascript" src="js/c3dl/c3dapi.js"></script>
    <script src="js/processing/processing.js"></script>
    <script src="js/processing/init.js"></script>
    <script language="javascript" src="js/scenecaster.js"></script>
  </head>
  <body>
    <input type="button" value="2D" onclick="show2d();" />
    <input type="button" value="3D" onclick="show3d();" />
    <input type="button" value="Google3dWarhouse" onclick="showgoogle();" />
    <br />
    <br />
      <div id="main3d">
        <div id="sidebar"> 
        <H1>Items</H1>
        <img src="images/sidebar/chair.jpg" onclick="createObject(0)" />
        <img src="images/sidebar/table.jpg" onclick="createObject(1)" />
        </div>
        <div id="scenecaster">
          <div id="buttons">
            <img src="images/icons/copy.jpg" title="Copy" onclick="copySelected()" />
            <img src="images/icons/moveup.jpg" title="Move up" onmousedown="buttonOn(0)" onmouseup="buttonOff(0)" />
            <img src="images/icons/movedown.jpg" title="Move down" onmousedown="buttonOn(1)" onmouseup="buttonOff(1)" />
            <img src="images/icons/rotateleft.jpg" title="Rotate left" onmousedown="buttonOn(2)" onmouseup="buttonOff(2)" />
            <img src="images/icons/rotateright.jpg" title="Rotate right" onmousedown="buttonOn(3)" onmouseup="buttonOff(3)" />
            <img src="images/icons/delete.jpg" title="Delete" onclick="deleteSelected()" />
            <img src="images/icons/scale.jpg" title="Scale" onclick="scale()"/>
            <img src="images/icons/lightup.jpg" title="Brighten scene" onmousedown="buttonOn(4)" onmouseup="buttonOff(4)" />
            <img src="images/icons/lightdown.jpg" title="Darken scene" onmousedown="buttonOn(5)" onmouseup="buttonOff(5)" />
          </div>
          <div id="screen">
            <canvas id="SceneCaster3d" style="" width="500" height="500"></canvas>
          </div>
        </div>
        <div id="widget">
          <table>
            <tr align=center>
              <td>Height</td>
              <td></td>
              <td></td>
              <td></td>
              <td>Zoom</td>
            </tr>
            <tr align=center>
              <td><input type="button" title="Increase camera height" value="+" onmousedown="buttonOn(6)" onmouseup="buttonOff(6)" /></td>
              <td></td>
              <td><input type="button" title="Move forward" value="&uarr;" onmousedown="buttonOn(10)" onmouseup="buttonOff(10)"/></td>
              <td></td>
              <td><input type="button" Title="Zoom in" value="+" onmousedown="buttonOn(8)" onmouseup="buttonOff(8)" /></td>
            </tr>
            <tr align=center>
              <td><div id="updownslider"></div></td>
              <td><input type="button" Title="Move left" value="&larr;" onmousedown="buttonOn(12)" onmouseup="buttonOff(12)" /></td>
              <td><input type="hidden" id="topview" value="">
                      <script type="application/processing">
                      float x=50;
                      float y=50;
                      float targetX, targetY;
                      float circleSize = 10;
                      bool moving=false;
                      void setup() 
                      {
                        size(100, 100); 
                        smooth();
                        noStroke();  
                      }

                      void draw() 
                      { 
                        
                        background( 255 );
                        if (inCircle(x, y, circleSize+5))
                            cursor("pointer"); 
                        else 
                            cursor( "default");  
                        if (document.getElementById("topview").value == "false") {
                          if (mousePressed == true && inCircle(x, y, circleSize+5) || moving) {
                            if (bigCircle(90)) {
                              cursor("pointer"); 
                              moving = true;
                              targetX = mouseX;
                              float dx = mouseX - x;
                              if(abs(dx) > 1) {
                                x += dx;
                              }
                              targetY = mouseY;
                              float dy = mouseY - y;
                              if(abs(dy) > 1) {
                                y += dy;
                              }
                            }
                          }
                        }
                        noFill();
                        stroke(0);
                        strokeWeight(5);
                        ellipse(50, 50, 95, 95);
                        fill(0,0,255);
                        stroke(0,0,255);
                        ellipse(x, y, circleSize, circleSize);
                        camleftright = (x -50) /100;
                        camupdown = (50 - y) /100;
                        if (document.getElementById("topview").value == "true") {
                          stroke(255,0,0);
                          line(0,0,200,200);
                          line(0,100,100,0);
                        }
                      }
                      void mouseReleased() {
                        moving =false;
                        x= 50;
                        y=50;
                      }
                      boolean inCircle(int x, int y, int diameter) 
                      {
                        float disX = x - mouseX;
                        float disY = y - mouseY;
                        if(sqrt(sq(disX) + sq(disY)) < diameter/2 ) {
                          return true;
                        } else {
                          return false;
                        }
                      }
                      boolean bigCircle(int diameter) 
                      {
                        float disX = 50 - mouseX;
                        float disY = 50 - mouseY;
                        if(sqrt(sq(disX) + sq(disY)) < diameter/2- circleSize/2) {
                          return true;
                        } else {
                          return false;
                        }
                      }
                      </script><canvas width="200" height="200"></canvas></td>
              <td><input type="button" Title="Move right" value="&rarr;" onmousedown="buttonOn(13)" onmouseup="buttonOff(13)" /></td>
              <td><div id="zoomslider"></div></td>
            </tr>
            <tr align=center>
              <td><input type="button" title="Decrease camera height" value="-" onmousedown="buttonOn(7)" onmouseup="buttonOff(7)" /></td>
              <td></td>
              <td><input type="button" title="Move backward" value="&darr;" onmousedown="buttonOn(11)" onmouseup="buttonOff(11)"/></td>
              <td></td>
              <td><input type="button" title="Zoom out" value="-" onmousedown="buttonOn(9)" onmouseup="buttonOff(9)" /></td>
            </tr>
            <tr>
              <td colspan="5" align=center>
                <input type="button" value="<< Cam" onclick="backCam()" />
                <input type="button" value="Top View" onclick="topView()" />
                <input type="button" value="Cam >>" onclick="forwardCam()" />
              </td>
            </tr>
          </table>
         <div id="3dinfo">
          <h2>Info</h2>
          *Items selected are blue
        </div>
        </div>  
      </div>
    <div id="main2d">
      <div> 
      <input type="hidden" id="pressed" value="0">
      <input type="hidden" id="objects" value="">
      <input type="hidden" id="run2d" value="">
      <img src="images/icons/newpage.jpg" title="New" onclick="Pressed(1)" />
      <img src="images/icons/copy.jpg" title="Copy" onclick="Pressed(2)" />
      <img src="images/icons/delete.jpg" title="Delete" onclick="Pressed(3)" />
      <img src="images/icons/drawwall.jpg" title="Draw walls" onclick="Pressed(4)" />
      <img src="images/icons/addlight.jpg" title="Insert lights" onclick="Pressed(5)" />
      <img src="images/icons/zoomin.jpg" title="Zoom in" onclick="Pressed(6)" />
      <img src="images/icons/zoomout.jpg" title="Zoom out" onclick="Pressed(7)" />
      <img src="images/icons/veiwall.jpg" title="View all" onclick="Pressed(8)" />
      </div>
      <script type="application/processing">
        int startx, starty, endx, endy,snapX,snapY;
        int[] walls= {((-25+100)*2.5)+23,((-25+100)*2.5)+23,((25+100)*2.5)+23,((-25+100)*2.5)+23,
        ((25+100)*2.5)+23,((-25+100)*2.5)+23,((25+100)*2.5)+23,((25+100)*2.5)+23,((25+100)*2.5)+23,
        ((25+100)*2.5)+23,((-25+100)*2.5)+23,((25+100)*2.5)+23,((-25+100)*2.5)+23,
        ((25+100)*2.5)+23,((-25+100)*2.5)+23,((-25+100)*2.5)+23};
        int numberwalls = 4;
        int[] lights= {(0+100)*2.5+23,(0+100)*2.5+23};
        int numberlights=1;
        int selectednum;
        int mdifX, mdifY;
        string selected;
        bool drawwall = false;
        string moving;
        bool insertlight = false;
        size(550, 550);
        int oldmX, oldmY;
        void draw() 
        {
          if (document.getElementById("run2d").value == "true") {
            var pressed = document.getElementById("pressed");
            if (pressed.value == "1")
              newPage();
            else if (pressed.value == "2")
              copy2d();
            else if (pressed.value == "3")
              deleteseletected();
            else if (pressed.value == "4")
              drawWallPress();
            else if (pressed.value == "5")
              insertLightPress();
            else if (pressed.value == "6")
              zoomIn();
            else if (pressed.value == "7")
              zoomOut();
            else if (pressed.value == "8")
              viewAll();

            strokeWeight(1);
            int axis = -100;
            int axis2 = -90;
            background(255);
            for(int i=0; i<=height-50; i+=25) {
              fill(0);
              if (axis2 <= 100) {
              if (i == 225)
                text(axis2,i+43,20);
              else
                text(axis2,i+38,20);
              }
              text(axis,0,i+25);
              axis += 10;
              axis2 += 10;
              if (i == 250)
                stroke(0);
              line(23, i+23, width-27, i+23);
              line(i+23, 23, i+23, height-27);
              stroke(150);
            }
            if (drawwall || insertlight) {
              cursor( "crosshair");  
              for(int i=23; i<=height-50; i+=25) {
               if (mouseX > i && mouseX < i+8)
                  snapX = i;
               else if (mouseX > i+8 && mouseX < i+16)
                  snapX = i+12.5;
               else if (mouseX > i+16 && mouseX < i+25)
                  snapX = i+25;
               
               if (mouseY > i && mouseY < i+8)
                  snapY = i;
               else if (mouseY > i+8 && mouseY < i+16)
                  snapY = i+12.5;
               else if (mouseY > i+16 && mouseY < i+25)
                  snapY = i+25;
              } 
              if (drawwall)
                fill(0);
              else 
                fill(255,255,0);
              ellipse(snapX, snapY, 5, 5);
            }
            else 
              cursor( "default"); 
                      
            var objs= [];
            objs = document.getElementById("objects").value;
            objs = objs.split(",");
            strokeWeight(1); 
            stroke(0); 
            fill(255,0,0);
            for (i = 0; i <= objs.length()-1; i+=4) {
              rect(((parseFloat(objs[i])+100)*2.5)+23,((parseFloat(objs[i+1])+100)*2.5)+23,parseFloat(objs[i+2])*2.5,parseFloat(objs[i+3])*-2.5); 
            }  
            
            for (int j = 0;j < numberwalls;j++) {
              strokeWeight(3);  
              stroke(0);            
              line(walls[j*4], walls[j*4+1], walls[j*4+2], walls[j*4+3]); 
            }
            for (int k = 0;k < numberlights;k++) {
              strokeWeight(1);  
              fill(255,255,0);
              ellipse(lights[k*2], lights[k*2+1], 10, 10);
            }
            //change mouse for seletion 
            if  (!drawwall && !insertlight) {
              for (int k = 0;k < numberlights;k++) {
                  int difX = mouseX - lights[k*2];
                  int difY= mouseY - lights[k*2+1];
                  if (difX < 10 && difX > -10 && difY < 10 && difY > -10) { 
                  cursor("pointer");
                  }
               }
                for (int j = 0;j < numberwalls;j++) {    
                  if (walls[j*4+2] == walls[j*4]) {
                    if (walls[j*4+3]-walls[j*4+1] > 0) {
                      for (i = 0; i < walls[j*4+3] - walls[j*4+1]; i++) {
                        int sdifX = mouseX - (walls[j*4]);
                        int sdifY= mouseY - (walls[j*4+1]+i);
                        if (sdifX < 3 && sdifX > -3 && sdifY < 3 && sdifY > -3)
                          cursor("pointer");
                      }
                    }
                    else if (walls[j*4+3]-walls[j*4+1] < 0) {
                      for (i = 0; i < walls[j*4+1]- walls[j*4+3]; i++) {
                        int sdifX = mouseX - (walls[j*4+2]);
                        int sdifY= mouseY - (walls[j*4+3]+i);
                        if (sdifX < 3 && sdifX > -3 && sdifY < 3 && sdifY > -3)
                          cursor("pointer");
                      }
                    }
                  }
                  else if (walls[j*4+2] - walls[j*4] > 0) {
                    var slope =(walls[j*4+3] - walls[j*4+1])/(walls[j*4+2] - walls[j*4])  
                    for (i = 0; i < walls[j*4+2]-walls[j*4]; i++) {
                      int sdifX = mouseX - (walls[j*4]+ i);
                      int sdifY= mouseY - (walls[j*4+1]+ (slope*i));
                      if (sdifX < 3 && sdifX > -3 && sdifY < 3 && sdifY > -3)
                        cursor("pointer");
                    }
                  }
                  else if (walls[j*4+2] - walls[j*4] < 0) {
                    var slope =(walls[j*4+1]-walls[j*4+3])/(walls[j*4]- walls[j*4+2])  
                    for (i = 0; i < walls[j*4] - walls[j*4+2]; i++) {
                      int sdifX = mouseX - (walls[j*4+2]+ i);
                      int sdifY= mouseY - (walls[j*4+3]+ (slope*i));
                      if (sdifX < 3 && sdifX > -3 && sdifY < 3 && sdifY > -3)
                        cursor("pointer");
                    }
                  }
                  int difX = mouseX - walls[j*4];
                  int difY= mouseY - walls[j*4+1];
                  int difX2 = mouseX - walls[j*4+2];
                  int difY2= mouseY - walls[j*4+3];
                  if (difX < 10 && difX > -10 && difY < 10 && difY > -10) { 
                  cursor("pointer");
                  }
                  else if (difX2 < 10 && difX2 > -10 && difY2 < 10 && difY2 > -10) { 
                  cursor("pointer");
                  }
                }
            } 
          } 
        }
        void mousePressed() {
          if (drawwall== true) {
            startx = snapX;
            starty = snapY;
          }    
          else if (!drawwall && !insertlight) {
            for (int k = 0;k < numberlights;k++) {
              int difX = mouseX - lights[k*2];
              int difY= mouseY - lights[k*2+1];
              if (difX < 10 && difX > -10 && difY < 10 && difY > -10) { 
              selectednum =k;
              selected = "light";
              }
            }
            for (int j = 0;j < numberwalls;j++) { 
                //select wall line 
                if (walls[j*4+2] == walls[j*4]) {
                  if (walls[j*4+3]-walls[j*4+1] > 0) {
                    for (i = 0; i < walls[j*4+3] - walls[j*4+1]; i++) {
                      int sdifX = mouseX - (walls[j*4]);
                      int sdifY= mouseY - (walls[j*4+1]+i);
                      if (sdifX < 3 && sdifX > -3 && sdifY < 3 && sdifY > -3) {
                        selectednum =j;
                        selected = "wall";
                        oldmX = mouseX;
                        oldmY = mouseY;
                      }
                    }
                  }
                  else if (walls[j*4+3]-walls[j*4+1] < 0) {
                    for (i = 0; i < walls[j*4+1]- walls[j*4+3]; i++) {
                      int sdifX = mouseX - (walls[j*4+2]);
                      int sdifY= mouseY - (walls[j*4+3]+i);
                      if (sdifX < 3 && sdifX > -3 && sdifY < 3 && sdifY > -3) {
                        selectednum =j;
                        selected = "wall";
                        oldmX = mouseX;
                        oldmY = mouseY;
                      }
                    }
                  }
                }
                else if (walls[j*4+2] - walls[j*4] > 0) {
                  var slope =(walls[j*4+3] - walls[j*4+1])/(walls[j*4+2] - walls[j*4])  
                  for (i = 0; i < walls[j*4+2]-walls[j*4]; i++) {
                    int sdifX = mouseX - (walls[j*4]+ i);
                    int sdifY= mouseY - (walls[j*4+1]+ (slope*i));
                    if (sdifX < 3 && sdifX > -3 && sdifY < 3 && sdifY > -3) {
                      selectednum =j;
                      selected = "wall";
                      oldmX = mouseX;
                      oldmY = mouseY;
                    }
                  }
                }
                else if (walls[j*4+2] - walls[j*4] < 0) {
                  var slope =(walls[j*4+1]-walls[j*4+3])/(walls[j*4]- walls[j*4+2])  
                  for (i = 0; i < walls[j*4] - walls[j*4+2]; i++) {
                    int sdifX = mouseX - (walls[j*4+2]+ i);
                    int sdifY= mouseY - (walls[j*4+3]+ (slope*i));
                    if (sdifX < 3 && sdifX > -3 && sdifY < 3 && sdifY > -3) {
                      selectednum =j;
                      selected = "wall";
                      oldmX = mouseX;
                      oldmY = mouseY;
                    }
                  }
                }  
                //select wall corners     
                int difX = mouseX - walls[j*4];
                int difY= mouseY - walls[j*4+1];
                int difX2 = mouseX - walls[j*4+2];
                int difY2= mouseY - walls[j*4+3];
                if (difX < 10 && difX > -10 && difY < 10 && difY > -10) { 
                selectednum =j;
                selected = "wall";
                oldmX = mouseX;
                oldmY = mouseY;
              }
              else if (difX2 < 10 && difX2 > -10 && difY2 < 10 && difY2 > -10) { 
                selectednum =j;
                selected = "wall";
                oldmX = mouseX;
                oldmY = mouseY;
              }
            }
          } 
        }
         	
        void mouseDragged() {
          if (selected == "light" || moving == "light") {
            for(int i=23; i<=height-50; i+=25) {
              if (mouseX > i && mouseX < i+8)
                  snapX = i;
              else if (mouseX > i+8 && mouseX < i+16)
                  snapX = i+12.5;
              else if (mouseX > i+16 && mouseX < i+25)
                  snapX = i+25;
              if (mouseY > i && mouseY < i+8)
                  snapY = i;
              else if (mouseY > i+8 && mouseY < i+16)
                  snapY = i+12.5;
              else if (mouseY > i+16 && mouseY < i+25)
                  snapY = i+25;
            } 
            lights[selectednum*2] = snapX;
            lights[selectednum*2+1] = snapY; 
            moveLight(selectednum, (snapX-23)/2.5-100,(snapY-23)/2.5-100);
            moving = "light";
          }
          if (selected == "wall" || moving == "wall") {
           //snape wall 
            mdifX = mdifX + mouseX - oldmX;
            mdifY = mdifY + mouseY - oldmY;
            
            var checkX1= walls[selectednum*4]+mdifX;
            var checkY1= walls[selectednum*4+1]+mdifY;
            var checkX2= walls[selectednum*4+2]+mdifX;
            var checkY2= walls[selectednum*4+3]+mdifY;
            
            for(int i=23; i<=height-50; i+=25) {
              if (checkX1 > i && checkX1 < i+8) {
               if (walls[selectednum*4] != i)
                mdifX = 0;
               walls[selectednum*4] = i;
              }
              else if (checkX1 > i+8 && checkX1 < i+16){
                if (walls[selectednum*4] != i+12.5)
                  mdifX = 0;
                walls[selectednum*4] = i+12.5;
              }
              else if (checkX1 > i+16 && checkX1 < i+25){
                if (walls[selectednum*4] != i+25)
                  mdifX = 0;
                walls[selectednum*4] = i+25;
              }
              if (checkY1 > i && checkY1 < i+8){
                if (walls[selectednum*4+1] != i)
                  mdifY = 0;
                walls[selectednum*4+1] = i;
              }
              else if (checkY1 > i+8 && checkY1 < i+16){
                if (walls[selectednum*4+1] != i+12.5)
                  mdifY = 0;
                walls[selectednum*4+1] = i+12.5;
              }
              else if (checkY1 > i+16 && checkY1 < i+25){
                if (walls[selectednum*4+1] != i+25)
                  mdifY = 0;
                walls[selectednum*4+1] = i+25;
              }
            } 
            for(int i=23; i<=height-50; i+=25) {
              if (checkX2 > i && checkX2 < i+8)
                  walls[selectednum*4+2] = i;
              else if (checkX2 > i+8 && checkX2 < i+16)
                  walls[selectednum*4+2] = i+12.5;
              else if (checkX2 > i+16 && checkX2 < i+25)
                  walls[selectednum*4+2] = i+25;
              if (checkY2 > i && checkY2 < i+8)
                  walls[selectednum*4+3] = i;
              else if (checkY2 > i+8 && checkY2 < i+16)
                  walls[selectednum*4+3] = i+12.5;
              else if (checkY2 > i+16 && checkY2 < i+25)
                  walls[selectednum*4+3] = i+25;
            } 
            oldmX = mouseX;
            oldmY = mouseY;
            moveWall(selectednum,[(walls[selectednum*4]-23)/2.5-100,0,(walls[selectednum*4+1]-23)/2.5-100], [(walls[selectednum*4+2]-23)/2.5-100, 0, (walls[selectednum*4+3]-23)/2.5-100]);
            moving =  "wall";
          }
          selected = "";
        }
        void mouseClicked() {
          if (insertlight && numberlights<8) {
             createLight((snapX-23)/2.5-100,(snapY-23)/2.5-100);
             lights[numberlights*2] = snapX;
             lights[numberlights*2+1] = snapY;
             numberlights++;
          }   
          else if (numberlights==8)
            alert("You have reached the limit of lights for a design layout");
        }
        
        void mouseReleased() {
          if (drawwall) {
            endx = snapX;
            endy = snapY;
            createWall([(startx-23)/2.5-100,0,(starty-23)/2.5-100], [(endx-23)/2.5-100, 0, (endy-23)/2.5-100]); 
            walls[numberwalls*4]=startx;  
            walls[numberwalls*4+1]=starty; 
            walls[numberwalls*4+2]=endx; 
            walls[numberwalls*4+3]=endy;
            numberwalls++;
          }  
          moving =  ""
        }
        void newPage() {
          numberwalls=0;
          numberlights=0;
          deleteScene();
          var pressed = document.getElementById("pressed");
          pressed.value = "0";
        }
        void copy2d() {
          var pressed = document.getElementById("pressed");
          pressed.value = "0";
        }
        void deleteseletected() {
          if (selected == "light") {
            for (int k = selectednum;k < numberlights-1;k++) {
              lights[k*2] = lights[k*2+2];
              lights[k*2+1] = lights[k*2+3];
            }
            deleteLight(selectednum);
            numberlights--;
          }
          if (selected == "wall") {
            for (int j = selectednum;j < numberwalls-1;j++) {
              walls[j*4]= walls[j*4+4];
              walls[j*4+1]= walls[j*4+5];
              walls[j*4+2]= walls[j*4+6];
              walls[j*4+3]= walls[j*4+7];
            }
            deleteWall(selectednum);
            numberwalls--;
          }
          selectednum=null;
          selected = "";
          var pressed = document.getElementById("pressed");
          pressed.value = "0";
        }
        void drawWallPress() {     
          drawwall =  (drawwall)? false : true;;
          insertlight = false;
          var pressed = document.getElementById("pressed");
          pressed.value = "0";
        }
        void insertLightPress() {
          insertlight = (insertlight)? false : true;
          drawwall = false;
          var pressed = document.getElementById("pressed");
          pressed.value = "0";
        }
        void zoomIn() {
          var pressed = document.getElementById("pressed"); 
          pressed.value = "0";
        }
        void zoomOut() {
          var pressed = document.getElementById("pressed");
          pressed.value = "0";
        }
        void viewall() {
          var pressed = document.getElementById("pressed");
          pressed.value = "0";
        }
      </script><canvas id="SceneCaster2d" style="" width="550" height="550"></canvas>
    </div>
    <div id="maingoogle">
      <div>
      <input type="button" value="Back" onclick="google3d.history.back()">
      <input type="button" value="Forward" onclick="google3d.history.forward()"> 
      </div>
      <iframe id="google3d" name="google3d" width="800" height="600" src="http://sketchup.google.com/3dwarehouse/">
      <script>
      if (document.google3d.download.onclick)
        alert("holy shit");
      </script>
    </div>
  </body>
</html>